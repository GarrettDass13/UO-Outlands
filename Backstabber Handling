//Set variables

@setvar! weapon_equipped 0

if not find 'headgear' 'self'
    overhead 'Target your headgear.'
    pause 200
    setvar 'headgear' 
endif

if not find 'wield_weapon' 'self'
    overhead 'Set weapon'
    setvar 'wield_weapon'
endif
//Set Timers
if not timerexists 'hatTimer'
    settimer 'hatTimer' 0
endif

//Disarm hit/miss set vars
if insysmsg 'Your strike disarms your'
        @setvar weWantToDisarm 1
	@setvar disarmOn 0
    elseif insysmsg 'You fail to disarm'
        @setvar weWantToDisarm 1
	@setvar disarmOn 0
endif
wait 250

//Don't disarm while unhidden
if not hidden and disarmOn = 1
    say '[disarm'
	wait 150
    if insysmsg 'You refrain from making disarm'
    @setvar disarmOn 0
	endif
	wait 500
endif

while hidden 'self'
//Disarm toggling
    if insysmsg 'You will now attempt to disarm your opponents'
        @setvar weWantToDisarm 0
        @setvar disarmOn 1
    elseif insysmsg 'You may now attempt to disarm your opponent again'
        @setvar weWantToDisarm 1
        @setvar disarmReady 1
    elseif insysmsg 'You refrain from making disarm'
        @setvar weWantToDisarm 1
    elseif insysmsg 'You feel ready to continue stealthing'
        if weWantToDisarm = 1
            say '[disarm'
        endif
    elseif weWantToDisarm = 1
            say '[disarm'
    endif
    wait 250
//Rearm weapon    
    if lhandempty and rhandempty
        overhead 'No weapon equipt retard'
        wait 2000
        dclick wield_weapon
    endif
//Wizardhat swapping
	if findtype '5912' 'self' as hat
		if stam == maxstam
			if timer 'hatTimer' > 2000
			settimer 'hatTimer' 0
			dclick hat
			pause 350
			dclick 'headgear'
			pause 350
			endif
		endif
	endif
endwhile

//Healing
if not hidden
	if hp < 45
		if not lhandempty
			hotkey "Arm/Disarm Left Hand"
		endif
		wait 250
		hotkey 'Drink Heal'
	endif

	if poisoned
		if findtype "Orange Potion" backpack as pot
			if not lhandempty or rhandempty
				overhead "Unwield weapon"
					if findlayer self lefthand as found
						@setvar! weapon_equipped found
						lift weapon_equipped
						drop backpack
						wait 250
					endif  
			endif
				dclick pot
				wait 250
			endif
	endif
endif
//Let's eat if we have it
if not findbuff "food" and findtype "tray" backpack as jood
    dclick jood
endif
loop
